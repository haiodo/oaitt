# üéôÔ∏è OAITT ‚Äî Open AI Transformer Transcriber

**–í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –Ω–∞ –±–∞–∑–µ OpenAI Whisper**

OAITT ‚Äî —ç—Ç–æ speech-to-text —Å–µ—Ä–≤–∏—Å —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ASR –¥–≤–∏–∂–∫–æ–≤, OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º API –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∫–∞—á–µ—Å—Ç–≤–∞.

---

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üöÄ **–î–≤–∞ ASR –¥–≤–∏–∂–∫–∞**: Hugging Face Transformers –∏ WhisperX
- üîå **OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π API**: Drop-in –∑–∞–º–µ–Ω–∞ –¥–ª—è OpenAI Whisper API
- ‚è±Ô∏è **–¢–æ—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏**: –ù–∞ —É—Ä–æ–≤–Ω–µ —Å–ª–æ–≤ (—Å WhisperX)
- üìä **–ú–µ—Ç—Ä–∏–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏**: –û—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
- ‚è∞ **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã**: –ó–∞—â–∏—Ç–∞ –æ—Ç –∑–∞–≤–∏—Å–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
- üçé **Apple Silicon**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MPS –¥–ª—è Mac
- üìù **–ú–Ω–æ–∂–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤**: JSON, —Ç–µ–∫—Å—Ç, SRT, VTT, TSV

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ __init__.py              # –í–µ—Ä—Å–∏—è –ø–∞–∫–µ—Ç–∞
‚îú‚îÄ‚îÄ app.py                   # FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª
‚îú‚îÄ‚îÄ config.py                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ
‚îú‚îÄ‚îÄ asr/                     # ASR –¥–≤–∏–∂–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ base.py              # –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å ASRModel
‚îÇ   ‚îú‚îÄ‚îÄ transformers.py      # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ HuggingFace Transformers
‚îÇ   ‚îú‚îÄ‚îÄ whisperx.py          # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ WhisperX
‚îÇ   ‚îî‚îÄ‚îÄ factory.py           # –§–∞–±—Ä–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ models/                  # Pydantic –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py           # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ (Segment, TranscriptionResponse)
‚îÇ   ‚îî‚îÄ‚îÄ openai.py            # OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ
‚îú‚îÄ‚îÄ routes/                  # HTTP –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ health.py            # GET /health - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
‚îÇ   ‚îú‚îÄ‚îÄ asr.py               # POST /asr - –æ—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
‚îÇ   ‚îî‚îÄ‚îÄ openai.py            # POST /v1/audio/transcriptions
‚îÇ
‚îú‚îÄ‚îÄ services/                # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ performance.py       # –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ timeout.py           # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–∞–π–º–∞—É—Ç–∞–º–∏
‚îÇ   ‚îî‚îÄ‚îÄ debug.py             # –û—Ç–ª–∞–¥–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ
‚îî‚îÄ‚îÄ utils/                   # –£—Ç–∏–ª–∏—Ç—ã
    ‚îú‚îÄ‚îÄ audio.py             # –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ
    ‚îú‚îÄ‚îÄ device.py            # –†–∞–±–æ—Ç–∞ —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (CUDA/MPS/CPU)
    ‚îî‚îÄ‚îÄ formatters.py        # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–≤–æ–¥–∞ (SRT/VTT/TSV)
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `ASRModel` | –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è ASR –¥–≤–∏–∂–∫–æ–≤ |
| `TransformersASR` | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ HuggingFace Transformers |
| `WhisperXASR` | –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ WhisperX —Å –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ–º —Å–ª–æ–≤ |
| `PerformanceTracker` | –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω—ã—Ö —Ç–∞–π–º–∞—É—Ç–æ–≤ |
| `TranscriptionResponse` | –ï–¥–∏–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ —Å —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ –∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ |

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd oaitt  # Open AI Transformer Transcriber

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python3.13 -m venv venv
source ./venv/bin/activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `ASR_ENGINE` | `transformers` | ASR –¥–≤–∏–∂–æ–∫: `transformers` –∏–ª–∏ `whisperx` |
| `WHISPER_MODEL` | `openai/whisper-large-v3` | –ú–æ–¥–µ–ª—å –¥–ª—è Transformers |
| `WHISPERX_MODEL` | `large-v3` | –ú–æ–¥–µ–ª—å –¥–ª—è WhisperX |
| `DEVICE` | `auto` | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: `auto`, `cuda`, `cpu`, `mps` |
| `COMPUTE_TYPE` | `float32` | –¢–∏–ø –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –¥–ª—è WhisperX |

### –°–µ—Ä–≤–µ—Ä

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `HOST` | `0.0.0.0` | –•–æ—Å—Ç –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ |
| `PORT` | `9007` | –ü–æ—Ä—Ç –¥–ª—è –ø—Ä–∏–≤—è–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞ |
| `MODEL_CACHE_DIR` | `./data` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –∫—ç—à–∞ –º–æ–¥–µ–ª–µ–π |
| `DEBUG_LOG_DIR` | *(–æ—Ç–∫–ª—é—á–µ–Ω–æ)* | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–æ—á–Ω—ã—Ö –ª–æ–≥–æ–≤ |
| `MODEL_IDLE_TIMEOUT` | `0` | –¢–∞–π–º–∞—É—Ç –≤—ã–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ (0 = –Ω–∏–∫–æ–≥–¥–∞) |

### –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `TIMEOUT_ENABLED` | `true` | –í–∫–ª—é—á–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã |
| `TIMEOUT_MULTIPLIER` | `2.0` | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –æ–∂–∏–¥–∞–µ–º–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ |
| `TIMEOUT_MIN_SECONDS` | `30.0` | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç |
| `TIMEOUT_MAX_SECONDS` | `300.0` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ç–∞–π–º–∞—É—Ç |
| `TIMEOUT_HISTORY_SIZE` | `100` | –†–∞–∑–º–µ—Ä –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞ |

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `CONFIDENCE_FILTER_ENABLED` | `false` | –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –Ω–∏–∑–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã |
| `CONFIDENCE_AVG_LOGPROB_THRESHOLD` | `-1.0` | –ü–æ—Ä–æ–≥ avg_logprob |
| `CONFIDENCE_NO_SPEECH_THRESHOLD` | `0.6` | –ü–æ—Ä–æ–≥ no_speech_prob |
| `CONFIDENCE_WORD_SCORE_THRESHOLD` | `0.5` | –ü–æ—Ä–æ–≥ –æ—Ü–µ–Ω–∫–∏ —Å–ª–æ–≤ |
| `CONFIDENCE_WORD_PROB_THRESHOLD` | `0.4` | –ü–æ—Ä–æ–≥ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ —Å–ª–æ–≤ |

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤ (chars/sec)

–î–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –≤—ã–¥–∞—ë—Ç —á—Ä–µ–∑–º–µ—Ä–Ω–æ –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ, –≤–≤–µ–¥–µ–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|--------------|----------|
| `MAX_CHARS_PER_SECOND` | `25.0` | –û–∂–∏–¥–∞–µ–º–∞—è –±–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ (—Å–∏–º–≤–æ–ª–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É) |
| `CHARS_PER_SECOND_MULTIPLIER` | `3.0` | –ú–Ω–æ–∂–∏—Ç–µ–ª—å –ø–æ—Ä–æ–≥–∞; –µ—Å–ª–∏ –Ω–∞–±–ª—é–¥–∞–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å > base * multiplier ‚Äî –ø–æ–º–µ—á–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π |
| `CHARS_PER_SECOND_MIN_AUDIO_SEC` | `0.5` | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ (—Å) –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ |

–ï—Å–ª–∏ –Ω–∞–±–ª—é–¥–∞–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ (len(text) / audio_duration_sec) –ø—Ä–µ–≤—ã—à–∞–µ—Ç `MAX_CHARS_PER_SECOND * CHARS_PER_SECOND_MULTIPLIER` –∏ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∞—É–¥–∏–æ –Ω–µ –º–µ–Ω—å—à–µ `CHARS_PER_SECOND_MIN_AUDIO_SEC`, —Ç–æ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –æ—à–∏–±–æ—á–Ω–∞—è ‚Äî –≤ –ø–æ–ª–µ `confidence.high_char_rate` —Å—Ç–∞–≤–∏—Ç—Å—è `true`, –≤ `confidence.rejection_reasons` –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏—á–∏–Ω–∞, –∞ `confidence.is_reliable` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≤ `false`. –ü—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –æ–ø—Ü–∏–∏ `CONFIDENCE_FILTER_ENABLED` —Å–µ—Ä–≤–∏—Å –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Ç–∞–∫–∏—Ö —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–π (—Å–º. `/asr` –∏ `/v1/audio/transcriptions`).

---

## üöÄ –ó–∞–ø—É—Å–∫

### –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫

```bash
# –ó–∞–ø—É—Å–∫ OAITT —Å Transformers (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
python main.py

# –ó–∞–ø—É—Å–∫ —Å WhisperX
ASR_ENGINE=whisperx python main.py

# –ù–∞ Apple Silicon
DEVICE=mps python main.py

# –° –æ—Ç–ª–∞–¥–æ—á–Ω—ã–º –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
DEBUG_LOG_DIR=./debug_logs python main.py
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–∞–∫ –º–æ–¥—É–ª—è

```python
from src.app import app, run_server

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
run_server(host="0.0.0.0", port=9007)
```

---

## üì° API Endpoints

### `GET /health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞.

```bash
curl http://localhost:9007/health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "model_loaded": true,
  "engine": "whisperx",
  "timeout_enabled": true,
  "performance": {
    "samples": 42,
    "avg_ratio": 0.0853,
    "avg_speed": 11.72
  }
}
```

### `POST /asr`

–û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `audio_file` | file | *required* | –ê—É–¥–∏–æ—Ñ–∞–π–ª |
| `output` | string | `json` | –§–æ—Ä–º–∞—Ç: `text`, `json`, `vtt`, `srt`, `tsv` |
| `task` | string | `transcribe` | –ó–∞–¥–∞—á–∞: `transcribe`, `translate` |
| `language` | string | *auto* | –ö–æ–¥ —è–∑—ã–∫–∞ |
| `word_timestamps` | bool | `true` | –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏ —Å–ª–æ–≤ |

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST "http://localhost:9007/asr" \
  -F "audio_file=@audio.wav" \
  -F "output=json"
```

### `POST /v1/audio/transcriptions`

**OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç** ‚Äî drop-in –∑–∞–º–µ–Ω–∞ –¥–ª—è OpenAI Whisper API.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–∏–ø | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|-----|--------------|----------|
| `file` | file | *required* | –ê—É–¥–∏–æ—Ñ–∞–π–ª |
| `model` | string | `whisper-1` | –ú–æ–¥–µ–ª—å (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è) |
| `language` | string | *auto* | –ö–æ–¥ —è–∑—ã–∫–∞ |
| `response_format` | string | `json` | –§–æ—Ä–º–∞—Ç: `json`, `text`, `srt`, `vtt`, `verbose_json` |
| `timestamp_granularities[]` | string[] | ‚Äî | –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å: `word`, `segment` |

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl -X POST "http://localhost:9007/v1/audio/transcriptions" \
  -F "file=@audio.wav" \
  -F "model=whisper-1" \
  -F "response_format=verbose_json" \
  -F "timestamp_granularities[]=word"
```

**–û—Ç–≤–µ—Ç (verbose_json):**
```json
{
  "text": "Hello world",
  "task": "transcribe",
  "language": "en",
  "duration": 2.5,
  "words": [
    {"word": "Hello", "start": 0.0, "end": 0.5, "prob": 0.95},
    {"word": "world", "start": 0.6, "end": 1.0, "prob": 0.92}
  ],
  "segments": [
    {
      "id": 0,
      "start": 0.0,
      "end": 1.0,
      "text": "Hello world",
      "avg_logprob": -0.3,
      "no_speech_prob": 0.01
    }
  ]
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏

–°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏:

| –ú–µ—Ç—Ä–∏–∫–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –•–æ—Ä–æ—à–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è |
|---------|----------|------------------|
| `avg_logprob` | –°—Ä–µ–¥–Ω—è—è log-–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ç–æ–∫–µ–Ω–æ–≤ | > -0.5 |
| `chars_per_second` | –ù–∞–±–ª—é–¥–∞–µ–º–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ (len(text) / duration) | –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —è–∑—ã–∫–∞ –∏ —Ç–µ–º–ø–∞ —Ä–µ—á–∏ (–æ–±—ã—á–Ω–æ < 25) |
| `chars_per_second_ratio` | –û—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ –±–∞–∑–æ–≤–æ–π —Å–∫–æ—Ä–æ—Å—Ç–∏ (`chars_per_second / MAX_CHARS_PER_SECOND`) | < multiplier (–Ω–∞–ø—Ä–∏–º–µ—Ä, < 3.0) |
| `high_char_rate` | –§–ª–∞–≥, –µ—Å–ª–∏ —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –∞–Ω–æ–º–∞–ª—å–Ω–æ –≤–µ–ª–∏–∫–∞ | `false` (–æ–∂–∏–¥–∞–µ—Ç—Å—è) |

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤ –º–æ–¥–µ–ª–∏ `Segment` –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `chars_per_second` ‚Äî —Å–∫–æ—Ä–æ—Å—Ç—å —Å–∏–º–≤–æ–ª–æ–≤ –≤–Ω—É—Ç—Ä–∏ —Å–µ–≥–º–µ–Ω—Ç–∞ (len(segment.text) / (segment.end - segment.start)). –≠—Ç–∏ –ø–æ–ª—è –ø–æ–º–æ–≥–∞—é—Ç –≤—ã—è–≤–ª—è—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –º–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—á–µ–Ω—å –º–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è (–≤–æ–∑–º–æ–∂–Ω–∞—è –≥–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏—è –∏–ª–∏ –æ—à–∏–±–æ—á–Ω–æ–µ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ).
| `no_speech_prob` | –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ—á–∏ | < 0.3 |
| `avg_word_score` | –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è —Å–ª–æ–≤ | > 0.7 |
| `avg_word_prob` | –°—Ä–µ–¥–Ω—è—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–ª–æ–≤ | > 0.6 |
| `low_prob_word_ratio` | –î–æ–ª—è —Å–ª–æ–≤ —Å –Ω–∏–∑–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é | < 0.3 |

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è `prob` (WhisperX)

| –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å | –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è |
|-------------|---------------|
| > 0.8 | –í—ã—Å–æ–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å |
| 0.5 - 0.8 | –°—Ä–µ–¥–Ω—è—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å |
| 0.2 - 0.5 | –ù–∏–∑–∫–∞—è —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å |
| < 0.2 | –°–ª–æ–≤–æ –≤–µ—Ä–æ—è—Ç–Ω–æ –æ—à–∏–±–æ—á–Ω–æ |

---

## ‚è∞ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç–∞–π–º–∞—É—Ç—ã

–°–µ—Ä–≤–∏—Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–Ω–∏–º–∞—é—Ç —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏:

1. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ `processing_time / audio_duration` –¥–ª—è –∫–∞–∂–¥–æ–π —É—Å–ø–µ—à–Ω–æ–π —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
2. –î–ª—è –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –æ–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏
3. –¢–∞–π–º–∞—É—Ç = `expected_time * TIMEOUT_MULTIPLIER`
4. –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è HTTP 408

**–≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞—Ç—å:**
- –ì–∞–ª–ª—é—Ü–∏–Ω–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏ (–±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã)
- –ó–∞–≤–∏—Å–∞–Ω–∏—è –∏–∑-–∑–∞ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ
- –ê–Ω–æ–º–∞–ª—å–Ω–æ –º–µ–¥–ª–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É

---

## üçé Apple Silicon (MPS)

| –î–≤–∏–∂–æ–∫ | –ü–æ–¥–¥–µ—Ä–∂–∫–∞ MPS |
|--------|---------------|
| `transformers` | ‚úÖ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (float16) |
| `whisperx` | ‚ö†Ô∏è Fallback –Ω–∞ CPU (ctranslate2 –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç MPS) |

–î–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ Apple Silicon –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `transformers`:

```bash
ASR_ENGINE=transformers DEVICE=mps python run.py
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

–ü—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–µ `DEBUG_LOG_DIR` —Å–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å:

```bash
DEBUG_LOG_DIR=./debug_logs python run.py
```

–°–æ–∑–¥–∞—é—Ç—Å—è —Ñ–∞–π–ª—ã:
- `{timestamp}_{filename}.wav` ‚Äî –∞—É–¥–∏–æ (16kHz mono)
- `{timestamp}_{filename}.json` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏

---

## üì¶ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- **FastAPI** ‚Äî –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **PyTorch** ‚Äî –≥–ª—É–±–æ–∫–æ–µ –æ–±—É—á–µ–Ω–∏–µ
- **Transformers** ‚Äî –º–æ–¥–µ–ª–∏ Whisper
- **WhisperX** ‚Äî –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å–ª–æ–≤
- **librosa** ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∞—É–¥–∏–æ

–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
pip install pip-tools
pip-compile --upgrade requirements.in -o requirements.txt
```

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

Copyright (c) 2025 Andrey Sobolev (haiodo@gmail.com)

---

## ü§ù Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

---

<p align="center">
  <b>OAITT</b> ‚Äî Open AI Transformer Transcriber<br>
  Copyright (c) 2025 Andrey Sobolev (haiodo@gmail.com)<br>
  Made with ‚ù§Ô∏è for the speech recognition community
</p>
